<?xml version="1.0"?>
<project basedir="." xmlns:ivy="antlib:org.apache.ivy.ant" name="CSPMonitor2-ivy">
	<property name="ivy.install.version" value="2.2.0" />
	<property name="ivy.jar.dir" value="${lib.dir}/ivy" />
	<property name="ivy.jar.file" value="${ivy.jar.dir}/ivy.jar" />
	<property name="ivy.sync" value="true" />
	<property name="ivy.use.symlinks" value="false" />
	<property name="central.repo" value="http://repo1.maven.org/maven2" />
	<property name="ithaka.repo" value="http://aa2cmjp03.ithaka.org:8081/nexus/content/groups/public" />
	<property name="jboss.repo" value="http://repository.jboss.org/nexus/content/groups/public" />
	<property name="jboss.deprecated.repo" value="https://repository.jboss.org/nexus/content/repositories/deprecated/" />

	<property name="ivy.retrieve.name.pattern" value="[artifact]-[revision](-[classifier]).[ext]" />
	<property name="ivy.retrieve.src.pattern" value="[artifact]-[revision](-[classifier])-[type]s.[ext]" />


	<!-- centralize some key artifact versions -->
	<property name="seam.version" value="2.2.2.Final" />
	<property name="jsf.version" value="1.2_12" />
	<property name="richfaces.version" value="3.3.3.Final" />
	<property name="icefaces.version" value="1.8.1" />
	<property name="jboss-embedded.version" value="beta3.SP10" />
	<property name="antlr.version" value="3.1.3" />

	<target name="init-ivy">
		<available property="ivy.installed" value="true" file="${ivy.jar.file}" type="file" />
	</target>

	<target name="load-ivy" depends="init-ivy,download-ivy">
		<path id="ivy.lib.path">
			<fileset dir="${ivy.jar.dir}" includes="*.jar" />
		</path>
		<taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpathref="ivy.lib.path" />
		<ivy:settings file="${basedir}/ivy.settings.xml" />
	</target>

	<target name="download-ivy" depends="init-ivy" unless="ivy.installed">
		<mkdir dir="${ivy.jar.dir}" />
		<echo message="Installing ivy..." />
		<get src="${central.repo}/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar" dest="${ivy.jar.file}" />
	</target>

	<target name="inflate-core" depends="load-ivy">
		<ivy:retrieve pattern="${lib.dir}/${ivy.retrieve.name.pattern}" type="jar" sync="${ivy.sync}" symlink="${ivy.use.symlinks}" conf="default" />
	</target>

	<target name="inflate-source" depends="load-ivy">
		<ivy:retrieve pattern="${lib.dir}/src/${ivy.retrieve.src.pattern}" type="source" sync="${ivy.sync}" symlink="${ivy.use.symlinks}" conf="sources" />
	</target>

	<target name="inflate-test" depends="load-ivy">
		<ivy:retrieve pattern="${lib.dir}/test/${ivy.retrieve.name.pattern}" type="jar" sync="${ivy.sync}" symlink="${ivy.use.symlinks}" conf="test" />
	</target>

	<target name="inflate" depends="inflate-core,inflate-source,inflate-test" />

	<target name="uninflate" depends="deflate" />

	<target name="deflate">
		<delete includeemptydirs="true" failonerror="false">
			<fileset dir="${lib.dir}">
				<include name="**/*.jar" />
			</fileset>
		</delete>
	</target>

	<target name="clean-ivy" depends="load-ivy">
		<ivy:cleancache />
	</target>

	<target name="dependency-report" depends="inflate">
		<ivy:report todir="${dist.dir}/dependency-report" />
	</target>

	<target name="deployed-jar-lst">
		<fileset dir="${lib.dir}" id="deployed.jars.lst">
			<include name="*.jar" />
			<!-- these exclusions are compile-time requirements, but not deploy-time requirements. -->
			<exclude name="el-api*.jar" />
			<exclude name="jta*.jar" />
			<exclude name="persistence-api*.jar" />
			<exclude name="servlet-api*.jar" />
			<exclude name="jsf-api*.jar" />
			<exclude name="jsf-impl*.jar" />
			<exclude name="hibernate-core*.jar" />
			<exclude name="hibernate-commons*.jar" />
			<exclude name="hibernate-entitymanager*.jar" />
			<exclude name="hibernate-validator*.jar" />
			<exclude name="hibernate-annotations*.jar" />
		</fileset>
		<pathconvert pathsep="${line.separator}" property="deployed-jars" refid="deployed.jars.lst">
			<mapper type="flatten" />
		</pathconvert>
		<echo file="deployed-jars.list">${deployed-jars}</echo>
	</target>


</project>
