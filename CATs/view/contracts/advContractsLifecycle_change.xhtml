<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:z="http://www.qualcomm.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:cats="http://www.ithaka.org/cats"
	xmlns:s="http://jboss.com/products/seam/taglib">

	<h2><h:outputText value="#{contractsLifecycleWizard.wizardTitle}" /></h2>

	<div id="step1">
	<ul class="steps">		
		<li class="selected">1. Change</li>
		<li class="disabled">2. Details</li>
		<li class="disabled">3. Roles-Riders</li>
		<li class="disabled">4. Results</li>
	</ul>
	<div class="cluster">	
		<s:div styleClass="title change" rendered="#{not contractsLifecycleWizard.isActiveBookAgreement()}">
			<h1> Info </h1>
			<p>Some information is required to advance the lifecycle of this agreement.</p>
		</s:div>	
		<div class="alert">
		
			<s:div rendered="#{contractsLifecycleWizard.origInstance.catType.label eq 'CSP' or contractsLifecycleWizard.origInstance.catType.label eq 'Backfile'}">
				<s:div rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New'}">
					<p class="highlight">Choose between <strong>Declined</strong>, <strong>LOI Signed</strong> and <strong>Active</strong>.</p>
				</s:div>
			</s:div>
			<s:div rendered="#{contractsLifecycleWizard.origInstance.catType.label eq 'Books'}">
				<s:div rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New'}">
					<p class="highlight">Choose between <strong>Declined</strong>, <strong>LOI Sent</strong>, <strong>LOI Signed</strong> and <strong>Active</strong>.</p>
				</s:div>
				<s:div rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Sent'}">
					<p class="highlight">Choose between <strong>Declined</strong>, <strong>LOI Signed</strong> and <strong>Active</strong>.</p>
				</s:div>
			</s:div>			
					
			<s:div rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Signed'}">
				<p class="highlight">Choose between <strong>Declined</strong> and <strong>Active</strong>.</p>
			</s:div>
			<s:div rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'Active' and contractsLifecycleWizard.origInstance.catType ne 'Books'}">
				<p class="highlight">You are changing the lifecycle to <strong>Terminated</strong>. All Agreement Details that are not already <strong>Declined</strong> or <strong>Terminated</strong> will also be <strong>Terminated</strong>.</p>
			</s:div>
			<s:div rendered="#{contractsLifecycleWizard.isActiveBookAgreement()}">
				<p class="highlight">Business logic and recordkeeping practices around a publisher leaving Books@JSTOR have not yet been determined as of April 18, 2012. Please contact CM Product Management and Support if you need to terminate an entire books agreement.</p>
			</s:div>
		</div>	
		
		
			<s:decorate id="catLifecycle_div" template="../layout/edit.xhtml" rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New' or contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Signed' or contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Sent'}">
					<ui:define name="label">Agreement Lifecycle</ui:define>
					<h:selectOneMenu name="catLifecycle" value="#{contractsLifecycleWizard.newLifecycleValue}"	requiredMessage="Required"   required="true" >
							<s:selectItems value="#{contractsLifecycleWizard.availableLifecycles}" var="i" itemValue="#{i}"
							              label="#{i.label}" noSelectionLabel="Choose..." />
							<a:support event="onchange" action="#{contractsLifecycleWizard.setPrimaryFields()}" reRender="contractsReqdPropsPanel" ajaxSingle="true" status="globalWaitStatus" limitToList="true"/>						              		
					</h:selectOneMenu>					
						<s:span rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New' and contractsLifecycleWizard.origInstance.catType.label eq 'Books'}" styleClass="comments">Choose <strong>LOI Sent</strong> if the Letter of Interest was sent to the publisher. Choose <strong>LOI Signed</strong> if you are confident the publisher and JSTOR will sign the Agreement. Choose <strong>Active</strong> if JSTOR has countersigned the Agreement. Choose <strong>Declined</strong> if either JSTOR or the publisher has decided against signing the Agreement.</s:span>
						<s:span rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New' and (contractsLifecycleWizard.origInstance.catType.label eq 'CSP' or contractsLifecycleWizard.origInstance.catType.label eq 'Backfile')}" styleClass="comments">Choose <strong>LOI Signed</strong> if you are confident the publisher and JSTOR will sign the Agreement. Choose <strong>Active</strong> if JSTOR has countersigned the Agreement. Choose <strong>Declined</strong> if either JSTOR or the publisher has decided against signing the Agreement.</s:span>
						<s:span rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Signed'}" styleClass="comments">Choose <strong>Active</strong> if JSTOR has countersigned the Agreement. Choose <strong>Declined</strong> if either JSTOR or the publisher has decided against signing the Agreement.</s:span>
						<s:span rendered="#{contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Sent'}" styleClass="comments">Choose <strong>LOI Signed</strong> if you are confident that the publisher will sign the Agreement. Choose <strong>Active</strong> if JSTOR has countersigned the Agreement. Choose <strong>Declined</strong> if either JSTOR or the publisher has decided against signing the Agreement.</s:span>
					
			</s:decorate>		
	
	<a:outputPanel id="contractsReqdPropsPanel" layout="block">
		<s:fragment rendered="#{contractsLifecycleWizard.origInstance.catType eq 'Books'}">
								
				<s:decorate id="catBksPorticoId" template="../layout/edit.xhtml" rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">
					<ui:define name="label">Books at JSTOR in Portico</ui:define>
					<h:selectOneMenu name="catBksPorticoSel" value="#{contractsLifecycleWizard.newInstance.catBooksPortico}" required="true">
						<s:selectItems itemValue="#{i.value}" label="#{i.label}"
							noSelectionLabel="Choose..." value="#{listsForEnums.yesNo}" var="i" />
						<a:support event="onchange" reRender="porticoFieldsPanel" ajaxSingle="true" status="globalWaitStatus" limitToList="true"/>	
					</h:selectOneMenu>
					<span class="comments">Are the publisher's Books at JSTOR books participating in Portico?</span>				
				</s:decorate>	
				
				<a:outputPanel layout="block" id="porticoFieldsPanel">
					<s:div id="booksPorticoPanelDiv" rendered="#{contractsLifecycleWizard.newInstance.catBooksPortico}">
						<s:decorate id="catBksPorticoAnnexId" template="../layout/edit.xhtml">
							<ui:define name="label">Books at JSTOR Portico Annex Countersigned</ui:define>
							<span class="read_only"><rich:calendar required="true" enableManualInput="true" datePattern="yyyy/MM/dd" disabled="false" 
								id="catContractBkPorticoAnnexDateCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catBooksPorticoAnnexDate}"/></span>
							<span class="comments">Date when ITHAKA countersigned the Portico Annex for this publisher's Books at JSTOR books.</span>
						</s:decorate>
					</s:div>
				</a:outputPanel>
				<s:decorate id="catBksDDA" template="../layout/edit.xhtml" rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">
					<ui:define name="label">DDA</ui:define>
					<h:selectOneMenu name="catBksDDASel" value="#{contractsLifecycleWizard.newInstance.catBksDDA}" required="true">
						<s:selectItems itemValue="#{i.value}" label="#{i.label}"
							noSelectionLabel="Choose..." value="#{listsForEnums.yesNo}" var="i" />
						</h:selectOneMenu>
					<span class="comments">Is the publisher participating in Demand Driven Acquisition?</span>				
				</s:decorate>		
				<s:decorate id="catContractBkInfoLoiSent" template="../layout/edit.xhtml" 
					rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'LOI Sent' or  contractsLifecycleWizard.newLifecycleValue.label eq 'LOI Signed' or 
								 	contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">
					<ui:define name="label">LOI Date Sent</ui:define>
					<span class="read_only"><rich:calendar enableManualInput="true"  datePattern="yyyy/MM/dd" disabled="false" id="catContractBkInfoLoiSentCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catLoiDateSent}"/></span>
					<span class="comments">Date when the Letter of Interest was sent to the publisher</span>
				</s:decorate> 
				
				<s:decorate id="catContractBkInfoLoiSigned" template="../layout/edit.xhtml" styleClass="lastdate" 
						rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'LOI Signed' or contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">
					<ui:define name="label">LOI Date Countersigned</ui:define>
					<span class="read_only"><rich:calendar enableManualInput="true"  datePattern="yyyy/MM/dd" disabled="false" id="catContractBkInfoLoiSignedCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catLoiDateRecvd}"/></span>
					<span class="comments">Date when the Letter of Interest was countersigned</span>
				</s:decorate> 	
				
				<s:decorate id="catContractBkInfoDateSent" template="../layout/edit.xhtml" styleClass="lastdate" rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'LOI Signed' or contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">
					<ui:define name="label">Agreement Date Sent</ui:define>
					<span class="read_only"><rich:calendar enableManualInput="true"  datePattern="yyyy/MM/dd" disabled="false" id="catContractInfoAgDateSentCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catAgreementDateSent}"/></span>
					<span class="comments">Date when Agreement was sent to publisher</span>
				</s:decorate> 
		</s:fragment>				
				
	
	<s:fragment rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Active'}">		
		<s:decorate id="catContractDate_div" template="../layout/edit.xhtml">
				<ui:define name="label">Agreement Date Signed</ui:define>
				<span class="read_only"><rich:calendar requiredMessage="Required" required="true" enableManualInput="true"  datePattern="yyyy/MM/dd" id="catContractDateCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catAgreementDate}"/></span>
				<span class="comments">Date countersigned by JSTOR.</span>
		</s:decorate>
		<s:decorate id="catContractVersion_div" template="../layout/edit.xhtml" rendered="#{contractsLifecycleWizard.origInstance.catType eq 'Backfile'}">
				<ui:define name="label">Agreement Version</ui:define>
				<h:inputText id="catContractVersion" size="25" maxlength="255"
                           requiredMessage="Required" required="true" 
					value="#{contractsLifecycleWizard.newInstance.catAgreementVersion}"></h:inputText>
				<span class="comments">JSTOR Agreement version name.</span>
		</s:decorate>
	
		<!-- <s:decorate id="catPubPorticoPartcpnt" styleClass="field" rendered="#{contractsLifecycleWizard.origInstance.catType eq 'Csp' or 
																			contractsLifecycleWizard.origInstance.catType eq 'Books'}">
					<rich:dataTable value="#{contractsLifecycleWizard.getPublishersList()}" var="_pub">
						<rich:column>					
							<label>Is<i><h:outputText value=" #{_pub.catName} "/></i>already a Portico participant?</label>							
							<h:selectOneMenu name="catPubPorticoPartcpntSelect"  value="#{contractsLifecycleWizard.catPubPorticoPartcipntMap[_pub]}"	required="true">
								<s:selectItems itemValue="#{i.value}" label="#{i.label}" value="#{listsForEnums.yesNo}" var="i" />
								<a:support event="onchange" action="#{contractsLifecycleWizard.setTogglePorticoRecdDateMap(_pub)}" reRender="porticoContractRecdPanel" ajaxSingle="true" status="globalWaitStatus" limitToList="true"/> 					
							</h:selectOneMenu>
							<a:outputPanel layout="none" id="porticoContractRecdPanel">
								<s:div rendered="#{contractsLifecycleWizard.getTogglePorticoRecdDateMapValue(_pub)}">							
									<label>When was the Portico agreement received?</label>
									<rich:calendar enableManualInput="true"  datePattern="yyyy/MM/dd" disabled="false" id="catPorticoContractDate" inputClass="datestyle" value="#{contractsLifecycleWizard.catPubPorticoRecdDateMap[_pub]}"/>
								</s:div>	
							</a:outputPanel>
						</rich:column>	    			
	    			</rich:dataTable>
		</s:decorate>
	-->
	</s:fragment>
	<s:fragment rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Terminated' and contractsLifecycleWizard.origInstance.catType ne 'Books'}">			
			<s:decorate id="catContractOutcome_div" template="../layout/edit.xhtml">
				<ui:define name="label">Outcome</ui:define>
					<h:selectOneMenu required="true" name="catContractOutcome" value="#{contractsLifecycleWizard.newInstance.catOutcome}">
							<s:selectItems itemValue="#{i}" label="#{i.label}" noSelectionLabel="Choose..." value="#{listsForEnums.catContracts_Outcome}" var="i"/>
							<a:support event="onchange" action="#{contractsLifecycleWizard.resetLists()}" reRender="contractsTerminatedProps" ajaxSingle="true" status="globalWaitStatus" limitToList="true"/>									             		
					</h:selectOneMenu>
					<span class="comments">Why was this Agreement <strong>Terminated</strong>? Use <strong>Withdrawn</strong> if the Publisher is leaving this JSTOR program. Use <strong>Transferred</strong> if the content covered by this Agreement will now be covered by another Publisher's Agreement. Use <strong>Signed New Agreement</strong> if the Publisher signed an updated version of the Agreement for this program.</span>
			</s:decorate>
			<s:decorate id="catTerminationDate_div" template="../layout/edit.xhtml">
				<ui:define name="label">Termination Date</ui:define>
				<span class="read_only"><rich:calendar required="true" enableManualInput="true"  datePattern="yyyy/MM/dd" id="catContractTermDateCal" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catTerminationDate}"/></span>
				<span class="comments">When was this Agreement <strong>Terminated</strong>? In cases where all of the content covered by one Publisher's Agreement has been transferred to a different Publisher's Agreement, set the <strong>Terminated Date</strong> of the old Publisher's Agreement to the day before the content starts being covered by the new Publisher's Agreement.</span>
			</s:decorate>		
		<a:outputPanel layout="block" id="contractsTerminatedProps">			
					<s:div rendered="#{(contractsLifecycleWizard.origInstance.catType eq 'Csp' or 
										 contractsLifecycleWizard.origInstance.catType eq 'Backfile') and 
										(contractsLifecycleWizard.newInstance.catOutcome eq 'Transferred' or 
										contractsLifecycleWizard.newInstance.catOutcome eq 'Signednewcontract')}">
						<ui:include src="advContractsLifecycle_activeContractsTable.xhtml"/>
					</s:div>			
		</a:outputPanel>
	</s:fragment>
	
	<s:fragment rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Declined'}">
		<s:decorate id="catContractDeclinedBy_div" template="../layout/edit.xhtml">
			<ui:define name="label">Declined By</ui:define>
						<h:selectOneMenu name="catDeclinedBy" value="#{contractsLifecycleWizard.newInstance.catDeclinedBy}" required="true" >							
							<f:selectItem itemLabel="Publisher" itemValue="Publisher"/> 	 	
							<f:selectItem itemLabel="JSTOR" itemValue="JSTOR"/>
						</h:selectOneMenu>			
			<span class="comments">Who declined this Agreement?</span>			
		</s:decorate>		
		<s:decorate id="catContractDeclinedNotes_div" template="../layout/edit.xhtml">
			<ui:define name="label">Reason Declined Notes</ui:define>		
				<h:inputTextarea cols="20" id="catContractDtlsReasonDeclined2" rows="2" value="#{contractsLifecycleWizard.newInstance.catDeclinedNotes}"/>
			<span class="comments">Optional notes about why this Agreement was Declined.</span>		
		</s:decorate>		
	</s:fragment>
	<s:fragment rendered="#{(contractsLifecycleWizard.origInstance.catType eq 'Books') and  (contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Signed'
	 or contractsLifecycleWizard.origInstance.catLifecycle.label eq 'LOI Sent' or contractsLifecycleWizard.origInstance.catLifecycle.label eq 'New' )}">			
		<s:decorate id="catAgreementDatePubSigned_div" template="../layout/edit.xhtml" rendered="true">
		<ui:define name="label">Date Agreement Signed by Publisher</ui:define>
		<span class="read_only"><rich:calendar enableManualInput="true"  datePattern="yyyy/MM/dd" 
		id="catAgreementDatePubSigned" inputClass="datestyle" value="#{contractsLifecycleWizard.newInstance.catAgreementDatePubSigned}"/></span>
		</s:decorate>
		</s:fragment>	
	
	<s:div styleClass="alert" rendered="#{contractsLifecycleWizard.newLifecycleValue.label eq 'Declined' and
											contractsLifecycleWizard.origInstance.catType.label eq 'Books'}">		
		<p class="highlight">When you hit continue, the system will try to advance your Agreement to <strong>Declined</strong>. If it succeeds, you will not be able to reset the lifecycle of the Agreement.</p>			
	</s:div>
	
		 
	<s:div styleClass="smart" rendered="#{empty contractsLifecycleWizard.errorMsgs}">	
		<div class="title change">
			<h1>Agreement</h1>
			<p>You are changing the lifecycle for this agreement.</p>		
		</div>
			<ui:include src="advContractsLifecycle_dumbContractsTable.xhtml">
				<ui:param name="value" value="#{contractsLifecycleWizard.contractsList}"/>
			</ui:include>
	</s:div>
	<s:div styleClass="smart" rendered="#{not empty contractsLifecycleWizard.origInstance.getContractDetailsList() and
										empty contractsLifecycleWizard.errorMsgs}">	
		<div class="title change">
			<h1>Agreement Details (#{contractsLifecycleWizard.origInstance.getContractDetailsList().size})</h1>
			<p>This agreement covers the following content.</p>		
		</div>										
			<ui:include src="advContractsLifecycle_contractDtlsTable.xhtml">
				<ui:param name="value" value="#{contractsLifecycleWizard.origInstance.getContractDetailsList()}"/>
			</ui:include>
	</s:div>
	
	</a:outputPanel>
	
	</div>
	<div class="push"></div> 
	<s:fragment rendered="#{not contractsLifecycleWizard.isActiveBookAgreement()}">
		<a:commandLink styleClass="button" value="Quit"  limitToList="true"
			oncomplete="#{rich:component('contractsLifecycleUpdateQuit')}.show();" status="globalWaitStatus" ignoreDupResponses="true" ajaxSingle="true"/> 
		<a:commandLink id="continuePanel" styleClass="button right" value="Continue" ignoreDupResponses="true"
				action="#{contractsLifecycleWizard.advLfclNext}" status="globalWaitStatus" disabled="#{not empty contractsLifecycleWizard.errorMsgs}"
				reRender="contractsLfclWizard" limitToList="true"/>
	</s:fragment>
	<s:fragment rendered="#{contractsLifecycleWizard.isActiveBookAgreement()}">
		<a:commandLink styleClass="button right" value="Return" limitToList="true" action="#{contractsLifecycleWizard.wizardReset}" 
		oncomplete="#{rich:component('contractsLifecycleUpdatePanel')}.hide(); javascript:location.reload(true)" rendered="#{empty pageURL}"
		status="globalWaitStatus" ignoreDupResponses="true"/>
		<a:commandLink styleClass="button right" value="Return" limitToList="true" action="#{contractsLifecycleWizard.wizardReset}" 
		oncomplete="#{rich:component('contractsLifecycleUpdatePanel')}.hide(); javascript:location.href=formatURL(location.href);" rendered="#{not empty pageURL}"
		status="globalWaitStatus" ignoreDupResponses="true"/>
	</s:fragment>
	
		</div>
</ui:composition>
